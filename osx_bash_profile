# vim: filetype=sh
# Source global definitions
if [ -f $HOME/.all_bash_profile ]; then
 . $HOME/.all_bash_profile
fi

# Turn colors on or off (used for MACOSX)
export CLICOLOR=1

#
# Aliases
#
alias unmount="diskutil unmount"

# cd to the path of the front Finder window
cdf() {
  target=`osascript -e 'tell application "Finder" to if (count of Finder windows) > 0 then get POSIX path of (target of front Finder window as text)'`
  if [ "$target" != "" ]; then
    cd "$target"; pwd
  else
    echo 'No Finder window found' >&2
  fi
}

# pcat (pretty cat) for shell code syntax highlighting
# Depends on the installation of Pygment
#
# conda install Pygment
#
# https://gist.github.com/BretFisher/6f688dde0122399efdca5a9d26100437
# https://coderwall.com/p/7wvx0g/syntax-highlighting-in-the-terminal-with-pygments
#
# -g: auto detection of lexer from file contents
#
# Can pass in `-l` if you want to override the lexer:
#   
#     pcat -l sh test.R
#
pcat() { 
  pygmentize -f terminal256 -O style=native -g $* | less -R
}

# Allows auto-completion of ssh hostnames
# Depends on the following (installed during `install_osx_software.sh`):
# 
# ```
# brew install bash-completion
# brew tap homebrew/completions
# ```
#
# https://apple.stackexchange.com/a/209269
if [ -f $(brew --prefix)/etc/bash_completion ]; then
. $(brew --prefix)/etc/bash_completion
fi

#----------
# fzf: Fuzzy finder
#----------
[ -f ~/.fzf.bash ] && source ~/.fzf.bash

# Bind ctrl-f to ctrl-t
# ctrl-t will also activate fzf_select
# https://github.com/junegunn/fzf/issues/546
bind "$(bind -s | grep __fzf_select | sed 's/\\C-t/\\C-f/')"

#----------
# Conda
#----------

# If conda is installed, add the bin folder to your PATH variable.
# Check if the argcomplete conda package is available, if so enable tab 
# complete.
if [[ -d ${HOME}/miniconda3 ]]; then

  echo "Found ${HOME}/miniconda3. Appending ${HOME}/miniconda3/bin to PATH"
  export PATH=${HOME}/miniconda3/bin:${PATH}

  # If the argcomplete conda package is available
  conda list argcomplete | grep "argcomplete" > /dev/null
  if [[ $? ]]; then
    eval "$(register-python-argcomplete conda)"
  else
    echo "conda argcomplete package is not installed. Consider installing with 'conda install argcomplete'. This would allow for conda tab complete"
  fi

fi

# If there is a .custom_bash_profile in the home directory, then source it.
# This is designed to allow for machine specific setups (e.g. alias commands
# that only work on a particular machine).
if [ -f $HOME/.custom_bash_profile ]; then
 . $HOME/.custom_bash_profile
fi
